clear all
set maxvar 32000
set matsize 10000
set more off, perm

cd C:\Users\Alex\Git_Repositories\Thesis

capture log close
log using Stata_log_files\office_workers.log,replace 

*data directory (where posted datasets are stored)
global datafiles "C:\Users\Alex\Git_Repositories\Thesis"

use  "$datafiles\Stata_Regressions\US_Paid_leave_analysis_altered.dta", clear

global X "i.rhcalyr i.lBirth i.rhcalyr#i.state i.lBirth#i.state i.lBirth#i.rhcalyr _LlBiXpos_2_1 _LlBiXpos_8_1-_LlBiXpos_50_1"

/* run DD regressions for various occupational groups, save the estimates for later use */
foreach i in rm_lfp working looking  {
	foreach j in 43 44 45 {
		xtreg `i' $X [pweight=end_weight] if industry_pre_birth=="`j'"
		estimates save Stata_ster\`i'_`j',replace 
	}
}

global X43_1  " rm_lfp  i.rhcalyr i.lBirth i.rhcalyr#i.state i.lBirth#i.state i.lBirth#i.rhcalyr _LlBiXpos_2_1 _LlBiXpos_8_1-_LlBiXpos_50_1 [pweight=end_weight] if industry_pre_birth == "43" "
global X43_2  " working i.rhcalyr i.lBirth i.rhcalyr#i.state i.lBirth#i.state i.lBirth#i.rhcalyr _LlBiXpos_2_1 _LlBiXpos_8_1-_LlBiXpos_50_1 [pweight=end_weight] if industry_pre_birth == "43" "
global X43_3  " looking i.rhcalyr i.lBirth i.rhcalyr#i.state i.lBirth#i.state i.lBirth#i.rhcalyr _LlBiXpos_2_1 _LlBiXpos_8_1-_LlBiXpos_50_1 [pweight=end_weight] if industry_pre_birth == "43" "


 
***************** Event-Study DD estimates for full sample and by education	  
foreach i of numlist 1 2 3 {
	xtreg X`i', fe  vce(cluster sippid)
	estimates save "C:\Users\Alex\Git_Repositories\Thesis\Stata_ster\office_workers\X`i'",replace
}

global window_m3_p3 "LlBiXpos_22_1 _LlBiXpos_23_1 _LlBiXpos_24_1 _LlBiXpos_25_1 _LlBiXpos_26_1 _LlBiXpos_27_1 _LlBiXpos_28_1"
global window_m0_p6 "LlBiXpos_25_1 _LlBiXpos_26_1 _LlBiXpos_27_1 _LlBiXpos_28_1 _LlBiXpos_29_1 _LlBiXpos_30_1 _LlBiXpos_31_1"

foreach i of numlist 1 2 3 {
	estimates use "C:\Users\Alex\Git_Repositories\Thesis\Stata_ster\office_workers\X`i'"
	test _LlBiXpos_22_1 _LlBiXpos_23_1 _LlBiXpos_24_1 _LlBiXpos_25_1 _LlBiXpos_26_1 _LlBiXpos_27_1 _LlBiXpos_28_1
	/* do a "return list" and an "ereturn list" to see how the results are reported, and what they are called */
	/* for example, the F-stat may be in r(F), in which case you can write "matrix F`i' = r(F)" */
	/* the probability value may be in r(p), in which case you can write "matrix p`i' = r(p)" */ 
	/* You can then concatenate the matrices: "matrix F_office_workers = F1, F2, F3 \ p1, p2, p3 */
	/* You can then executive a svmat command to store the matrix as a Stata dataset and you can save it */
}


matrix b_all = j(49,1,.) 
foreach j in 43 44 45 {
	foreach i in rm_lfp working looking {
	    /* read in the estimates */
		estimates use `i'_`j'
		/* store the coefficients in a column vector that you create and name b`i'_`j' */
		matrix b`i'_`j'=e(b) 
		/* collect all of the coefficients into the matrix b_all */
		matrix b_all = b_all , b`i'_`j'
		foreach k in m3_p3 m0_p6 {
			test window_`k' 
			display"************************************   F-test of window `k' for occupation `j' and dependent variable `i' ***************************"
	}
}

matrix list b_all

svmat b_all,

log close

	
